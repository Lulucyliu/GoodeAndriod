<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<script src="js/jquery-3.2.1.js"></script>
		<script src="js/jquery.min.js"></script>
	</head>

	<body>
		<script src="js/mui.min.js"></script>
		<script src="js/update.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

		</script>
		<header class="mui-bar mui-bar-nav" id="headerTitle" style="background-color: #FFFFFF;box-shadow: 0 0 1px #c8c7cc">
			<!-- <a id="goto"> -->
				<!-- <img alt=" "  src="img/menu-icon.png" style="margin-top: 10px;"/> -->
			<!-- </a> -->
			<h1 class="mui-title" style="text-align: left;margin-left: 0px;font-size: 15px;padding-left: 0px;left: 12px;font-family: 'SimHei';"><b>Goode企业顾问</b></h1>
		</header>
		<div style="background-color: #FFFFFF;color: #FFFFFF;">
		</div>
		<!-- 	<div id="slider" class="mui-slider" >
			<div class="mui-slider-group mui-slider-loop"> -->
		<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
		<!-- <div class="mui-slider-item mui-slider-item-duplicate">
					<a href="#">
						<img src="img/3-1.jpg">
					</a>
				</div> -->
		<!-- 第一张 -->
		<!-- <div class="mui-slider-item">
					<a href="#">
						<img src="img/1-1.jpg">
					</a>
				</div> -->
		<!-- 第二张 -->
		<!-- 	<div class="mui-slider-item">
					<a href="#">
						<img src="img/2-1.jpg">
					</a>
				</div> -->
		<!-- 第三张 -->
		<!-- 	<div class="mui-slider-item">
					<a href="#">
						<img src="img/3-1.jpg">
					</a>
				</div>	 -->
		<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
		<!-- 		<div class="mui-slider-item mui-slider-item-duplicate">
					<a href="#">
						<img src="img/1-1.jpg">
					</a>
				</div>
			</div>
			<div class="mui-slider-indicator">
				<div class="mui-indicator mui-active"></div>
				<div class="mui-indicator"></div>
				<div class="mui-indicator"></div>
			</div>
		</div>
		<div class="mui-content">
			<ul class="mui-table-view mui-grid-view mui-grid-9">
						<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
										<span class="mui-icon mui-icon-home"></span>
										<div class="mui-media-body">主页</div></a></li>
						<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
										<span class="mui-icon mui-icon-more"></span>
										<div class="mui-media-body">更多</div></a></li>
				</ul> -->
		<!-- <img src="img/buttom.jpg" style="width: 100%;" />
			<img src="img/buttom.jpg" style="width: 100%;" /> -->
		<!-- <ul class="mui-table-view mui-grid-view mui-grid-9">
		            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                    <span class="mui-icon mui-icon-home"></span>
		                    <div class="mui-media-body">主页</div></a></li>
		            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                    <span class="mui-icon mui-icon-email"><span class="mui-badge">5</span></span>
		                    <div class="mui-media-body">未处理</div></a></li>
		            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                    <span class="mui-icon mui-icon-chatbubble"></span>
		                    <div class="mui-media-body">新消息</div></a></li>
		            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                    <span class="mui-icon mui-icon-location"></span>
		                    <div class="mui-media-body">待处理</div></a></li>
		            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                    <span class="mui-icon mui-icon-search"></span>
		                    <div class="mui-media-body">查询</div></a></li>
		            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                    <span class="mui-icon mui-icon-gear"></span>
		                    <div class="mui-media-body">设置</div></a></li>
		            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                   <span class="mui-icon mui-icon-info"></span>
		                    <div class="mui-media-body">关于我们</div></a></li>
		           <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
		                    <span class="mui-icon mui-icon-more"></span>
		                    <div class="mui-media-body">更多</div></a></li>
		        </ul> -->
		<!-- 	 <ul class="mui-table-view mui-grid-view mui-grid-9">
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
													<img src="img/1.jpg" style="width: 100px; height: 100px;"/></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
													<img src="img/2.jpg" style="width: 100px; height: 100px;"/></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
													<img src="img/3.jpg" style="width: 100px; height: 100px;"/></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
													<img src="img/4.jpg" style="width: 100px; height: 100px;"/></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
													<img src="img/5.jpg" style="width: 100px; height: 100px;"/></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
													<img src="img/6.jpg" style="width: 100px; height: 100px;"/></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
												<img src="img/7.jpg" style="width: 100px; height: 100px;"/></li>
								<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
									<img src="img/8.jpg" style="width: 100px; height: 100px;"/></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
										<img src="img/3.jpg" style="width: 100px; height: 100px;"/></li>
							</ul> -->
		<!-- <ul class="mui-table-view mui-grid-view mui-grid-9">
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													<span class="mui-icon mui-icon-home"></span>
													<div class="mui-media-body">主页</div></a></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													</a></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													</a></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													<span class="mui-icon mui-icon-home"></span>
													<div class="mui-media-body">主页</div></a></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													</a></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													</a></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													<span class="mui-icon mui-icon-home"></span>
													<div class="mui-media-body">主页</div></a></li>
									<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="#">
													</a></li>
							</ul> -->
		<!-- </div> -->
	</body>
	<script>
		mui.init({
			statusBarBackground: '#f7f7f7'
		});
		var userid = '';
		var usertype = '';
		
		//已有账户登录
		function recentUserLogin() {
			
						if (localStorage.getItem('userid') && localStorage.getItem('password')) {
							// alert("no happy");
							var useridr=localStorage.getItem('userid');
							var passwordr=localStorage.getItem('password');
							$.ajax({ 
											//url: 'http://api.map.baidu.com/location/ip?ak=ia6HfFL660Bvh43exmH9LrI6',   
											//url: 'http://118.24.8.104:8081/Goode/ApiLogin',   
											//url: 'http://localhost:8080/Goode/ApiLogin/findfunctions',
											//url: 'http://172.28.23.211:8080/Goode/ApiLogin/findfunctions',
											url: 'http://121.42.29.124:8180/Goode/ApiLogin',
											//url: 'http:118.24.8.104:8081/Goode/ApiLogin',
											timeout: 30000,				
											type: 'POST',
											data:{username: useridr,
									password: passwordr},
											dataType: "jsonp", 
											success:function(data) {
												var usertyper='';
												usertyper=data.usertype;
										
													userid=useridr;
													usertype=usertyper;
										
											},
											error:function(XMLHttpRequest, textStatus, errorThrown){
												//alert(errorThrown)
												//alert(url)
											alert("ERRor")
										}
											});
						} 
		};
		
		//定义自动登陆的方法，如果本地存储存在则执行主动登陆，如果不存在则打开登陆页面，隐藏index页面
		var userid = localStorage.getItem('userid'); //本地存储，存储你的用户名
		var password = localStorage.getItem('password'); //本地存储，存储你的密码
		//真实项目下应该存储一个服务器返回的token，通过token来实现自动登陆，保护用户的数据安全
		
		var aniShow = "pop-in";
// 		var menu = null,
// 			showMenu = false;
		var isInTransition = false;
		var _self;
		//只有ios支持的功能需要在Android平台隐藏；
		if (mui.os.android) {
			var list = document.querySelectorAll('.ios-only');
			if (list) {
				for (var i = 0; i < list.length; i++) {
					list[i].style.display = 'none';
				}
			}
			//Android平台暂时使用slide-in-right动画
			if (parseFloat(mui.os.version) < 4.4) {
				aniShow = "slide-in-right";
			}
		}
		var subpages = ['yewu.html', 'index-menu.html'];
		var activeTab = subpages[0];
		var subpage_style = {
			top: '45px',
			bottom: '51px',
			zindex: 999
		};

		//加载主框
		var tabPage = null;
		var tabbar = "tab.html";
		var tabbar_style = {
			height: '51px',
			bottom: '0px',
			background: 'transparent',
			zindex: 9999
		}
		var aniShow = {};
		//初始化，并预加载webview模式的选项卡			
		function preload(userid, usertype) {

			// 				var menu_style = {
			// 					left: "-70%",
			// 					width: '70%',
			// 					popGesture: "none",
			// 					render:"always"
			// 				};
			// 
			// 				if(mui.os.ios) {
			// 					menu_style.zindex = -1;
			// 				}
			//              alert('我传给菜单的userid'+userid);
			//处理侧滑导航，为了避免和子页面初始化等竞争资源，延迟加载侧滑页面；
			// 				menu = mui.openWindow({
			// 					id: 'index-menu.html',
			// 					url: 'index-menu.html',
			// 					styles: menu_style,
			// 					extras:{
			//                         userid:userid,
			//                         usertype:usertype,
			//                    },
			// 					show: {
			// 						aniShow: 'none'
			// 					},
			// 					waiting: {
			// 						autoShow: false
			// 					}
			// 				});
		};
		mui.plusReady(function() {
			// var self = plus.webview.currentWebview();
			if (localStorage.getItem('userid') && localStorage.getItem('password')) {
			recentUserLogin();
		
			var storage = window.localStorage;
			userid = storage.userid;
			
			
			usertype = storage.usertype;
			//获取当前子页
			var self = plus.webview.currentWebview();

			tabPage = plus.webview.create(tabbar, tabbar, tabbar_style);
			self.append(tabPage);
			//加载子页
			for (var i = 0; i < 2; i++) {
				var temp = {};

				var sub = plus.webview.create(subpages[i], subpages[i], subpage_style);

				if (i > 0) {
					sub.hide();
				} else {
					temp[subpages[i]] = "true";
					mui.extend(aniShow.temp);
				}
				self.append(sub);
			}
			//设置页面名称
			//		var wv = plus.webview.currentWebview();
			//              wv.setStyle({
			//                  titleNView: {
			//                      titleText: '主页',
			//                  }
			//              });
			//仅支持竖屏显示
			plus.screen.lockOrientation("portrait-primary");
			plus.navigator.closeSplashscreen();
			plus.navigator.setFullscreen(false);
			//预加载
			preload(userid, usertype);
			}
			//绘制顶部图标
			// _self = plus.webview.currentWebview();
			// var titleView = document.getElementById('#headerTitle');

			//开启回弹
// 			_self.setStyle({
// 				bounce: "vertical",
// 				bounceBackground: "#efeff4",
// 				popGesture: 'none' //首页有侧滑菜单，因此屏蔽首页的侧滑关闭功能
// 			});

			//titleView.interceptTouchEvent(true);
			// 				mui('.mui-bar').on('tap','#goto',function(e) {
			// 					//alert('你点击了菜单');
			// 					var x = e.clientX;
			// 					if(x < 44) { //触发menu菜单
			// 						var _left = parseInt(_self.getStyle().left);
			// 						if(_left > 0) { //处于显示状态
			// 							closeMenu();
			// 						} else {
			// 							openMenu();
			// 						}
			// 					} 
			//    				}, false);

			//启用侧滑拖拽操作，延时的原因是menu页是延时创建的，所以这里需要相应延时
			// 				setTimeout(function() {
			// 					_self.drag({
			// 						direction: "right",
			// 						moveMode: "followFinger"
			// 					}, {
			// 						view: menu,
			// 						moveMode: "follow"
			// 					}, function(e) {//这个地方的e是用来干嘛的
			// 						//console.log(JSON.stringify(e));
			// 					});
			// 				}, 350);
			else{
				mui.openWindow({
					url: 'login.html',
					
					id: 'login.html'
				});
			}

		});
		// 		mui('.mui-bar').on('tap','#goto',function(){
		// 			openMenu();
		// 		});

		/**
		 * 显示侧滑菜单
		 */
		// 			function openMenu() {
		// 				plus.webview.startAnimation({
		// 						'view': _self,
		// 						'styles': {
		// 							'fromLeft': '0',
		// 							'toLeft': "70%"
		// 						},
		// 						'action': 'show'
		// 					}, {
		// 						'view': menu,
		// 						'styles': {
		// 							'fromLeft': "-70%",
		// 							'toLeft': '0'
		// 						},
		// 						'action': 'show'
		// 					},
		// 					function(e) {
		// 						//console.log(JSON.stringify(e));
		// 						if(e.id == menu.id) { //侧滑菜单打开
		// 						}
		// 					}.bind(this)
		// 				)
		// 			};
		/**
			 * 关闭菜单
// 			 */
		// 			function closeMenu() {
		// 				plus.webview.startAnimation({
		// 						'view': _self,
		// 						'styles': {
		// 							'fromLeft': '70%',
		// 							'toLeft': "0"
		// 						},
		// 						'action': 'show'
		// 					}, {
		// 						'view': menu,
		// 						'styles': {
		// 							'fromLeft': "0",
		// 							'toLeft': '-70%'
		// 						},
		// 						'action': 'show'
		// 					},
		// 					function(e) {
		// 						console.log(JSON.stringify(e));
		// 						if(e.id == _self.id) {}
		// 					}.bind(this)
		// 				)
		// 			};
		// window.addEventListener("menu:close", closeMenu);

		var _toast = false;

		mui.back = function() {
			// 				if(parseInt(_self.getStyle().left) > 0) {
			// 					closeMenu();
			// 					return;
			// 				}
			if (!_toast || !_toast.isVisible()) {
				_toast = mui.toast('再按一次返回键退出', {
					duration: 'long',
					type: 'div'
				});
			} else {
				plus.runtime.quit();
			}
		}

		//重写mui.menu方法，Android版本menu按键按下可自动打开、关闭侧滑菜单；
		// 			mui.menu = function() {
		// 				if(parseInt(_self.getStyle().left) > 0) {
		// 					closeMenu();
		// 				} else {
		// 					openMenu();
		// 				}
		// 			};
		//当前激活的选项
		//		    var activeTab = subpages[0];
		//			window.addEventListener('tagLi', function(event) {
		//			
		//			//获取选项卡点击事件参数
		//			var targetTitle = event.detail.targetTitle;
		//			var targetList = event.detail.targetList;
		//				
		//			if(targetList == activeList)
		//				return;
		//
		//			//更换标题
		//			mui(".mui-title")[0].innerHTML = targetTitle;
		//
		////                 alert('我正在更换标题'+targetList);
		//			if(!plus.webview.getWebviewById(targetList)) {
		//				var sub = plus.webview.create(targetList, targetList, subpage_style);
		//				plus.webview.currentWebview().append(sub);
		//				plus.webview.show(sub, 'pop-in', 300);
		//			} else {
		//				//显示目标选项卡
		//				plus.webview.show(targetList);
		//			}
		//			//更改当前活跃的选项卡
		//			closeMenu();
		//			activeList = targetList;
		//		});

		window.addEventListener('exit', function(e) {
			// closeMenu();
			//循环隐藏子页面
			var children = plus.webview.getWebviewById('index.html').children();
			mui.each(children, function(index, item) {
				plus.webview.hide(item.id);
			});
			mui.confirm('确定退出登录？', '提示', ['确定', '取消'], function(e) {
				if (e.index == 0) {
					localStorage.clear();
					plus.runtime.restart();
				} else {
					mui.each(children, function(index, item) {
						plus.webview.show(item.id);
					});
				}
			}, 'div');
		});

		window.addEventListener('tagTab', function(event) {
			//获取选项卡点击事件参数
			var targetTitle = event.detail.targetTitle;
			var targetTab = event.detail.targetTab;
			if (targetTab == activeTab)
				return;

			//更换标题
			// mui(".mui-title")[0].innerHTML = targetTitle;

			if (!plus.webview.getWebviewById(targetTab)) {
				// alert("comein");
				var sub = plus.webview.create(targetTab, targetTab, subpage_style);
				plus.webview.currentWebview().append(sub);
				plus.webview.show(sub, 'pop-in', 300);
			} else {
				//显示目标选项卡
				
				plus.webview.show(targetTab);
			}
			//重新加载tabbar
			tabPage.show();
			//隐藏当前
			// alert(activeTab);
			plus.webview.hide(activeTab);
			//更改当前活跃的选项卡
			activeTab = targetTab;
			// alert(activeTab);
		});


		/*
		 * 后期待解决问题区域
		 */
		//①输入框改变窗体大小问题

		//		    var height = document.documentElement.clientHeight || document.body.clientHeight;
		//          window.onresize = function() {
		//              var heightView = document.documentElement.clientHeight || document.body.clientHeight;
		//              if(heightView*1 < height*1) {//heightView<height证明窗口被挤压了     
		//              	plus.webview.currentWebview().setStyle({
		//                      height: height
		//                  });
		//              //修改父页面高度的时候，也要修改子页面的高度  因为子页面距离父页面底部始终是51px  所以这里只需要用父页面的高度减去51px,就是子页面的高度
		//              plus.webview.getWebviewById('view/menu/indexmenu.html').setStyle({height: height});
		//              }
		//          
		//          };
	</script>

</html>
