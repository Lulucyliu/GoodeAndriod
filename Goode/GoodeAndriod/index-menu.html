<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title></title>
    <script src="js/mui.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8">
      	mui.init(
      		{
				swipeBack: false,
				keyEventBind: {
					backbutton: false //关闭back按键监听
				}
			}
      	);
    </script>
    <script type="text/javascript" src="js/jquery-3.2.1.js" ></script>
	<script type="text/javascript" src="js/jquery.i18n.properties-min-1.0.9.js" ></script>
	<script type="text/javascript" src="js/language.js" ></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/menuall.css" rel="stylesheet"/>
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.css">
</head>
<body>  
	<div class="mui-content" id="all-menu">
      	<!--顶部菜单（头像/名称）-->
      	<div id="top-menu" >
      		<img id="top-background-img" src="img/top-background.jpg"/>
      
        	    <div id="menu-peronimg" >
        		    <img src="img/4.jpg" />
        	    </div>
           <div id="menu-username"></div>
           	
        	<div id="top-user-imformaton" > 	 
        	    <!--js中加代码-->
        	   <div id='menu-detailInfor' style="display: inline-block;margin-top: 5px;width: 150px;">
        	   	<span id="menu-statu"></span>&nbsp;&nbsp;&nbsp;
        	   	<!--<span class="fa fa-star"></span><span class="fa fa-star"></span>-->
        	   </div>
              
               
        	</div>
        </div>
    <div id="offCanvasSideScroll" class="mui-scroll-wrapper" >
      <div class="mui-scroll">
        <!-- 菜单具体展示内容 -->
        <div id="middle-menu">
        	<!--中间选择菜单-->
            <ul class="mui-table-view mui-table-view-chevron" id='mainLeftMenu'>
    
            </ul>
        </div>
        
      </div>
    </div>
      <!--底部菜单栏-->
        <div id="bottom-menu">
        	<div style="display: inline;position: absolute;width: 33.33%;text-align: center;">   
        	<a id="setting"   style="color:#000000;">		
        		<span class="fa fa-wrench" style="margin-top: 18px;"></span>
				<span class="mui-tab-label" style="margin-top: 5px;">修改密码</span>
            </a>
			</div>
			<div style="display: inline;position: absolute;left:33.33%;width: 33.33%;text-align: center;">    	    
         	<a id="login" style="color:#000000;" >
         	  <span class="fa fa-sign-out" style="margin-top: 18px;"></span>
				<span  class="mui-tab-label" style="margin-top: 5px;">注销</span>				
			</a>
			</div> 
			<div style="display: inline;position: absolute;left:66.67%;width: 33.33%;text-align: center;">                                                                                                                                                                                                                                                                                                                                                                                                                    	    
         	<a id="close" style="color:#000000;" >
         	  <span class="fa fa-window-close-o" style="margin-top: 18px;"></span>
				<span  class="mui-tab-label" style="margin-top: 5px;">退出</span>				
			</a>
			</div> 
        </div>
	</div>
      
    <script type="text/javascript" charset="utf-8"> 
    var aniShow = "slide-in-right";
// mui.ajax('http://121.42.29.124:8081/Goode/ApiLogin/findfunctions',{
//	data:{
//		userid:'1',
//	},	       
//	async:false,
//	dataType:'json',//服务器返回json格式数据
//	type:'GET',//HTTP请求类型
//	//alert(data);
//	timeout:10000,//超时时间设置为10秒；
//
//	success:function(data){
//		//服务器返回响应，根据响应结果，分析是否登录成功；
//		var flag=0;
//			var mainstr='';
//			var sonstr='';
//				for(var i=0;i<data.length;i++){
//					//是一级菜单
//					if(data[i].parentid=='-1'){
//						mainstr+='<li class="mui-table-view-cell mui-collapse" id="'+data[i].functionid+'">'
//						        //+'<a class="mui-navigate-right">'
//						        /*
//						         * 待添加href-url
//						         */
//						        +'<a id="'+data[i].functionid+'a" class="hasAHref" href="url">'
//                              +data[i].functionName
//                              +'</a>'
//                              +'</li>';
//                      $("#mainLeftMenu").append(mainstr);
//                      //再进行查询看是否有子功能
//                      for(var j=0;j<data.length;j++){
//					        //是一级菜单
//					        if(data[j].parentid==data[i].functionid){
//						        if(flag==0){//第一次证明是第一个二级子菜单
//						        	flag=1;
//						            sonstr+='<ul class="mui-table-view mui-table-view-chevron" id="'+data[j].parentid+'ul"></ul>';
//						            $("#"+data[j].parentid+"a").addClass("mui-navigate-right");
//						            $("#"+data[j].parentid+"a").removeClass("hasAHref");
//						            $("#"+data[j].parentid).append(sonstr);
//						            sonstr='';
//						        }
//						        /*
//						         * 待添加href-url
//						         */
//						        sonstr+='<li class="mui-table-view-cell"><a id="'+data[j].functionid+'a" style="width:255px;"  class="hasAHref" href="view/menu/findcompany.html">'+data[j].functionName+'</a></li>';
//						    $("#"+data[j].parentid+"ul").append(sonstr);
//						    sonstr='';
//				            }
//				        }
//                      flag=0;//将是否是第一个子菜单重新置零
//				    }
//				mainstr='';
//				}
//	},
//	error:function(xhr,type,errorThrown){
//		//异常处理；
//		alert(type+xhr+errorThrown);
//		console.log(type);
//	}
//});
var userid;
var usertype;
var htqc='';
  mui.plusReady(function() {
    	//得到登陆页面的参数
        
    	// var self = plus.webview.currentWebview();
			var storage=window.localStorage;
			userid=storage.userid;
			usertype = storage.usertype;
			if (localStorage.getItem('userid') && localStorage.getItem('password')) 
			sendRequsetInformation(userid,usertype);
			// sendRequest(userid,usertype);
    	var aniShow = "slide-in-right";
			//关于backbutton和menubutton两个按键的说明，在iOS平台不存在，故需隐藏
// 			if(!mui.os.android) {
// 				var span = document.getElementById("android-only")
// 				if(span) {
// 					span.style.display = "none";
// 				}
// 			}

// 			var subWebview = null,
// 				template = null,
// 				index = null;
// 				//获得主页面webview引用；
// 				index = plus.webview.currentWebview().opener();
// 				var _self = plus.webview.currentWebview();
// 				_self.drag({
// 					direction: "left",
// 					moveMode: "followFinger"
// 				}, {
// 					view: index,
// 					moveMode: "follow"
// 				}, function(e) {});
			});
			
// 	
// 	mui('#mainLeftMenu').on('tap', 'a', function() {
// 			//alert();
// 			var targetList = this.getAttribute("href");
// 			var id=this.getAttribute('id');
// 			var aclass = this.getAttribute('class');
// 			if(~aclass.indexOf('hasAHref')){
// 				
// 				//alert(targetList);
// 			var href = this.href;
// 			//alert(targetList);
// 			mui.openWindow({
// 						url: targetList,
// 						id: targetList,
// 						extras:{
// 								userid:userid,
// 								usertype:usertype,
// 						}
// 			});
// 		}
// 	});
	//用户信息		
	function sendRequsetInformation(userid,usertype){
	    	$.ajax({
		    //url: 'http://api.map.baidu.com/location/ip?ak=ia6HfFL660Bvh43exmH9LrI6',   
		    //url: 'http://118.24.8.104:8081/Goode/ApiLogin',   
		    //url: 'http://localhost:8080/Goode/ApiLogin/findfunctions',
		    url: 'http://121.42.29.124:8180/Goode/ApiLogin/userInfo',
		    //url: 'http:118.24.8.104:8081/Goode/ApiLogin',
		    timeout: 30000,	
			data:{userid:userid,
			      usertype:usertype},			
		    type: 'GET',
		    dataType: "json", 
		    success:function(data) {
		    	var menuUsername = document.getElementById('menu-username');
		    	var menuStatu = document.getElementById('menu-statu');
		    	menuUsername.innerHTML=data.name;
		    	//律师
		    	if(~usertype.indexOf('lawyer')){
		    	    menuStatu.innerHTML='律师';
		    		var starsum = parseInt(data.star);
		    		var startStr = '';
		    		var jifenStr = '';
		    		for(var i=0;i<starsum;i++){
		    			startStr = startStr+ '<span class="fa fa-star">';
		    		}
		    		$('#menu-detailInfor').append(startStr);
		    		jifenStr='<div id="jifen" style="display: inline-block;"><span class="fa fa-gift"></span>积分</div>';
		    		$('#top-user-imformaton').append(jifenStr);
		    	}//企业
		    	else if(~usertype.indexOf('client')){
		        	menuStatu.innerHTML='企业';
		    		var jifenStr = '';
		    		var VipStr='<span class="fa fa-trophy"></span>';
		    		VipStr=VipStr+data.vip;
		    		$('#menu-detailInfor').append(VipStr);
		    		jifenStr='<div id="jifen" style="display: inline-block;"><span class="fa fa-gift"></span>积分</div>';
		    		$('#top-user-imformaton').append(jifenStr);
		    	}//管理员
		    	else if(~usertype.indexOf('admin')){
		    		//暂无动作
		    	    menuStatu.innerHTML='管理员';
		    	}
			},
		    error:function(XMLHttpRequest, textStatus, errorThrown){
		    	//alert(errorThrown)
		    	//alert(url)
				alert("ERRor");
			}
		    });
	    };
	//获得用户对应功能列表 
//   function sendRequest(userid){
//         	$.ajax({
// 		    //url: 'http://api.map.baidu.com/location/ip?ak=ia6HfFL660Bvh43exmH9LrI6',   
// 		    //url: 'http://118.24.8.104:8081/Goode/ApiLogin',   
// 		    //url: 'http://localhost:8080/Goode/ApiLogin/findfunctions',
// 		    url: 'http://121.42.29.124:8180/Goode/ApiLogin/findfunctions',
// 		    //url: 'http:118.24.8.104:8081/Goode/ApiLogin',
// 		    timeout: 30000,	
// 			data:{userid:userid,
// 			      usertype:usertype,},			
// 		    type: 'GET',
// 		    dataType: "json", 
// 		    success:function(data) {
// 			var flag=0;
// 			var mainstr='';
// 			var sonstr='';
// //			alert(userid);
//                 //第一个数据为用户个人信息，从第二个数据开始读取
// 				for(var i=0;i<data.length;i++){
// 					//是一级菜单s
// 					if(data[i].parentid=='-1'){
// 						mainstr+='<li class="mui-table-view-cell mui-collapse" id="'+data[i].functionid+'">'
// 						        //+'<a class="mui-navigate-right">'
// 						        +'<a id="'+data[i].functionid+'a">'
//                                 +data[i].functionName
//                                 +'</a>'
//                                 +'</li>';
//                         $("#mainLeftMenu").append(mainstr);
//                         //再进行查询看是否有子功能
//               for(var j=0;j<data.length;j++){
// 					        //是一级菜单
// 					        if(data[j].parentid==data[i].functionid){
// 						        if(flag==0){//第一次证明是第一个二级子菜单
// 						        	flag=1;
// 						            sonstr+='<ul class="mui-table-view mui-table-view-chevron" id="'+data[j].parentid+'ul"></ul>';
// 						            $("#"+data[j].parentid+"a").addClass("mui-navigate-right");
// 						            $("#"+data[j].parentid).append(sonstr);
// 						            sonstr='';
// 						        }
// 						        sonstr+='<li class="mui-table-view-cell menu"><a id="'+data[j].functionid+'a" style="width:255px;"  class="hasAHref" href="'+data[j].appurl+'">'+data[j].functionName+'</a></li>';
// 						        $("#"+data[j].parentid+"ul").append(sonstr);
// 						        sonstr='';
// 				            }
// 				      }
// 							//无子菜单
// 							if(flag==0){
// 								$("#"+data[i].functionid+"a").addClass("hasAHref");
// 								$("#"+data[i].functionid+"a").attr("href",data[i].appurl);
// 							}
//               flag=0;//将是否是第一个子菜单重新置零
// 				    }
// 				mainstr='';
// 				}
// 		    },
// 		    error:function(XMLHttpRequest, textStatus, errorThrown){
// 		    	//alert(errorThrown)
// 		    	//alert(url)
// 				alert("ERRor");
// 			}
// 		    });
// 		  };
        window.onload = function(){       	
            mui('#offCanvasSideScroll').scroll();     
        };
				
				
				
		//----------------------------------------下方三个部件的案件方法-----------------------------------
		$('#login').on('tap', function() {
//			var indexpage=plus.webview.getWebviewById('index.html');
//			mui.fire(indexpage,'exit',{});
             mui.confirm('确定退出登录？', '提示', ['确定', '取消'], function(e) {
            if(e.index == 0) {
                localStorage.clear();
                plus.runtime.restart();
            }
            });
//              localStorage.clear();
//              plus.runtime.restart();
        });
        $('#setting').on('tap', function() {
        	var webview_style = {
					popGesture: "close",
					statusbar : {
						background: "#f7f7f7"
					}
				}		
				var extras = {};
        var webview = plus.webview.create('view/Cpassword/changepsw.html', 'view/Cpassword/changepsw.html', webview_style, extras);
		webview.addEventListener("loaded", function() {
						webview.show(aniShow, 300);
					});
        });
        
        $('#close').on('tap', function(){
        	// localStorage.clear();
        	plus.runtime.quit();
        });
    </script>  
</body> 
</html>